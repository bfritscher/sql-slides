<section>
<section>
Trajet <label>de <select id="villeDe">
    <option>Bern</option>
    <option>Bienne</option>
    <option>Lausanne</option>
    <option>Neuchâtel</option>
    <option>Yverdon-les-Bains</option>
    </select></label>
<label>à
<select id="villeVers">
    <option>Bern</option>
    <option>Bienne</option>
    <option>Lausanne</opti"on>
    <option>Neuchâtel</option>
    <option>Yverdon-les-Bains</option>
</select></label>
<div class="layout-two">
<div class="w-66">
<pre class="sql"><code id="sql" class="smaller">WITH Trajets (ville_de, ville_vers, trajet) 
AS (SELECT ville_de, ville_vers, ville_de ||
    '->' || ville_vers
    FROM Autoroutes_cycles
    UNION ALL
    SELECT T.ville_de,  A.ville_vers,
      T.trajet || '->'|| A.ville_vers
    FROM Trajets T, Autoroutes_cycles A
    WHERE A.ville_de = T.ville_vers
    AND T.trajet NOT LIKE '%' ||
    A.ville_vers || '%'
)
SELECT trajet
FROM trajets
WHERE ville_de = '{de}'
AND ville_vers = '{vers}';</code></pre>
<ul id="trajets" class="smaller"></ul>
</div>
<svg style="padding:0 2%" id="autoroutes" width="400pt" height="394pt" viewBox="0.00 0.00 400.00 394.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph1" class="graph" transform="scale(1 1) rotate(0) translate(4 390)">
<title>_anonymous_0</title>
<polygon fill="white" stroke="white" points="-4,5 -4,-390 397,-390 397,5 -4,5"></polygon>
<!-- Bern -->
<g id="Be" class="node"><title>Bern</title>
<polygon fill="forestgreen" stroke="black" stroke-width="0" points="392,-271.5 226,-271.5 226,-228.5 392,-228.5 392,-271.5"></polygon>
<text text-anchor="middle" x="309" y="-245.8" font-family="Arial" font-size="16.00" fill="white" font-weight="bold">Bern</text>
</g>
<!-- Bienne -->
<g id="Bi" class="node"><title>Bienne</title>
<polygon fill="forestgreen" stroke="black" stroke-width="0" points="298,-385.5 132,-385.5 132,-342.5 298,-342.5 298,-385.5"></polygon>
<text text-anchor="middle" x="215" y="-359.8" font-family="Arial" font-size="16.00" fill="white" font-weight="bold">Bienne</text>
</g>
<!-- Bern&#45;&gt;Bienne -->
<g id="BeBi" class="edge"><title>Bern-&gt;Bienne</title>
<path fill="none" stroke="black" d="M291.759,-271.543C274.904,-291.625 249.376,-322.041 232.45,-342.208"></path>
<text text-anchor="middle" x="297.003" y="-311.2" font-family="Arial" font-size="14.00">42 km</text>
<text text-anchor="middle" x="297.003" y="-294.4" font-family="Arial" font-size="14.00">32 min</text>
</g>
<!-- Neuchâtel -->
<g id="Ne" class="node"><title>Neuchâtel</title>
<polygon fill="forestgreen" stroke="black" stroke-width="0" points="166,-271.5 0,-271.5 0,-228.5 166,-228.5 166,-271.5"></polygon>
<text text-anchor="middle" x="83" y="-245.8" font-family="Arial" font-size="16.00" fill="white" font-weight="bold">Neuchâtel</text>
</g>
<!-- Neuchâtel&#45;&gt;Bern -->
<g id="NeBe" class="edge"><title>Neuchâtel-&gt;Bern</title>
<path fill="none" stroke="black" d="M166.191,-250C185.699,-250 206.484,-250 225.985,-250"></path>
<text text-anchor="middle" x="196" y="-234.4" font-family="Arial" font-size="14.00">47 km</text>
<text text-anchor="middle" x="196" y="-217.6" font-family="Arial" font-size="14.00">40 min</text>
</g>
<!-- Neuchâtel&#45;&gt;Bienne -->
<g id="NeBi" class="edge"><title>Neuchâtel-&gt;Bienne</title>
<path fill="none" stroke="black" d="M107.211,-271.543C130.879,-291.625 166.727,-322.041 190.496,-342.208"></path>
<text text-anchor="middle" x="190.003" y="-311.2" font-family="Arial" font-size="14.00">32 km</text>
<text text-anchor="middle" x="190.003" y="-294.4" font-family="Arial" font-size="14.00">27 min</text>
</g>
<!-- Yverdon&#45;les&#45;Bains -->
<g id="Yv" class="node"><title>Yverdon-les-Bains</title>
<polygon fill="forestgreen" stroke="black" stroke-width="0" points="273,-157.5 107,-157.5 107,-114.5 273,-114.5 273,-157.5"></polygon>
<text text-anchor="middle" x="190" y="-131.8" font-family="Arial" font-size="16.00" fill="white" font-weight="bold">Yverdon-les-Bains</text>
</g>
<!-- Yverdon&#45;les&#45;Bains&#45;&gt;Bern -->
<g id="YvBe" class="edge"><title>Yverdon-les-Bains-&gt;Bern</title>
<path fill="none" stroke="black" d="M207.883,-157.724C226.507,-179.306 252.994,-210 252.994,-210 252.994,-210 265.923,-219.003 279.357,-228.358"></path>
<text text-anchor="middle" x="274.003" y="-197.2" font-family="Arial" font-size="14.00">70 km</text>
<text text-anchor="middle" x="274.003" y="-180.4" font-family="Arial" font-size="14.00">43 min</text>
</g>
<!-- Yverdon&#45;les&#45;Bains&#45;&gt;Neuchâtel -->
<g id="YvNe" class="edge"><title>Yverdon-les-Bains-&gt;Neuchâtel</title>
<path fill="none" stroke="black" d="M170.375,-157.543C151.189,-177.625 122.13,-208.041 102.863,-228.208"></path>
<text text-anchor="middle" x="174.003" y="-197.2" font-family="Arial" font-size="14.00">39 km</text>
<text text-anchor="middle" x="174.003" y="-180.4" font-family="Arial" font-size="14.00">24 min</text>
</g>
<!-- Lausanne -->
<g id="La" class="node"><title>Lausanne</title>
<polygon fill="forestgreen" stroke="black" stroke-width="0" points="348,-43.5 182,-43.5 182,-0.5 348,-0.5 348,-43.5"></polygon>
<text text-anchor="middle" x="265" y="-17.8" font-family="Arial" font-size="16.00" fill="white" font-weight="bold">Lausanne</text>
</g>
<!-- Lausanne&#45;&gt;Bern -->
<g id="LaBe" class="edge"><title>Lausanne-&gt;Bern</title>
<path fill="none" stroke="black" d="M275.703,-43.8701C280.458,-53.1426 285,-62 285,-62 285,-62 300.091,-179.585 306.34,-228.273"></path>
<text text-anchor="middle" x="319.95" y="-140.2" font-family="Arial" font-size="14.00">100 km</text>
<text text-anchor="middle" x="319.95" y="-123.4" font-family="Arial" font-size="14.00">58 min</text>
</g>
<!-- Lausanne&#45;&gt;Yverdon&#45;les&#45;Bains -->
<g id="LaYv" class="edge"><title>Lausanne-&gt;Yverdon-les-Bains</title>
<path fill="none" stroke="black" d="M251.244,-43.5425C237.796,-63.6246 217.428,-94.0414 203.923,-114.208"></path>
<text text-anchor="middle" x="260.003" y="-83.2" font-family="Arial" font-size="14.00">32 km</text>
<text text-anchor="middle" x="260.003" y="-66.4" font-family="Arial" font-size="14.00">20 min</text>
</g>
</g>
</svg>
</div>
<script type="text/javascript" src="js/autoroutes.js"></script>
</section>
<section>
<h3>Javascript source</h3>
<pre style="height:80%;width:100%" class="center no-margin javascript"><code style="max-height:98%">function toIdList(path){
    var nodes = path.split('->');
    var list = nodes.map(function(item){
        return item.substr(0,2);
    });
    var de,a='';
    for(var i=0; i < nodes.length-1; i++){
        de=nodes[i].substr(0,2);
        a=nodes[i+1].substr(0,2);
        list.push(de+a);
        list.push(a+de);
    }
    return list;
}

function highlight(path){
    var ids = toIdList(path);
    $('#autoroutes .edge path').each(function(idx, el){
        var $el = $(el);
        var options = {stroke:'black', 'stroke-width':'1'};
        if(ids.indexOf($el.parent().attr('id')) > -1){
           options = {stroke:'red', 'stroke-width':'2'};
         }
        $el.attr(options);
    });
    $('#autoroutes .node polygon').each(function(idx, el){
        var $el = $(el);
        var options = {stroke:'black', 'stroke-width':'0'};
        if(ids.indexOf($el.parent().attr('id')) > -1){
           options = {stroke:'red', 'stroke-width':'2'};
         }
        $el.attr(options);
    });
}

function query(){
    var sql = $('#sql').text();
    sql = sql.replace('{de}', $('#villeDe').val());
    sql = sql.replace('{vers}', $('#villeVers').val());
    jQuery.ajax({
      url:'https://amc.ig.he-arc.ch/sqlexplorer/api/evaluate',
      type:'POST',
      dataType:'json',
      contentType:'application/json',
      data:JSON.stringify({db: 'SQLAVANCE',sql: sql}),
      success:function(data){
          var $ul = $('#trajets');
          $ul.empty();
          data.content.forEach(function(item){
             $('<li>' + item[0] + '</li>').appendTo($ul);
          });
      }
    });
}

$('select').on('change', query);
$('#trajets').on('click', 'li', function(){
    $('#trajets li').removeClass('warn');
    highlight($(this).addClass('warn').text());
});</code></pre>
</section>
</section>